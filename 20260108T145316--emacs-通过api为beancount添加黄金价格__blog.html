<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2026-01-08 周四 21:32 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>emacs-通过API为beancount添加黄金价格</title>
<meta name="generator" content="Org Mode" />
<link rel='stylesheet' type='text/css' href='/org.css'/>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href=""> UP </a>
 |
 <a accesskey="H" href="index.html"> HOME </a>
</div><div id="preamble" class="status">
<p>▼ 本文更新于 <span class="timestamp-wrapper"><span class="timestamp">[2026-01-08 周四 21:31]</span></span></p>
</div>
<div id="content" class="content">
<header>
<h1 class="title">emacs-通过API为beancount添加黄金价格</h1>
</header><p>
<span class="timestamp-wrapper"><time class="timestamp" datetime="2026-01-08T14:53:00">[2026-01-08 周四 14:53]</time></span><br>
</p>


<p>
最近开始把一部分钱配置到黄金里了，这样一来，就需要想个办法通过代码获取黄金价格。<br>
</p>

<p>
一方面，及时的黄金价格API一般都是给量化等公司商用的，价格很贵；另一方面，beancount的最小粒度为「天」，也没有必要把黄金价格精确到分钟/小时。在网上寻找了一番，找到了<a href="https://www.juhe.cn/">聚合数据</a>的api，注册登录实名认证后就能获取到 <code>KEY</code> ，每天50次通过API获取<a href="https://www.juhe.cn/docs/api/id/29">黄金相关数据</a>。<br>
</p>

<p>
beancount中，我的黄金货币为 <code>AU</code> ，默认货币为 <code>CN</code> ，所以可以通过 <code>2026-01-01 price AU 114514 CN</code> 来设置某天的 <code>AU</code> 与 <code>CN</code> 之间兑换比例。<br>
</p>

<p>
然后执行下列代码，就能获取昨天的黄金价格并且输出一条beancount的定价文本，记得将 <code>KEY</code> 替换为你获得的key：<br>
</p>

<div class="org-src-container">
<pre class="src src-elisp"><code><span style="color: #007047;">(</span><span style="color: #444fcf;">let</span> <span style="color: #444fcf;">(</span><span style="color: #3a6f00;">(</span>prev <span style="color: #1f66af;">(</span>org-read-date nil nil <span style="color: #006f70;">"-1d"</span><span style="color: #1f66af;">)</span><span style="color: #3a6f00;">)</span>
      <span style="color: #3a6f00;">(</span>result <span style="color: #006f70;">""</span><span style="color: #3a6f00;">)</span><span style="color: #444fcf;">)</span>
  <span style="color: #444fcf;">(</span><span style="color: #444fcf;">let</span> <span style="color: #3a6f00;">(</span><span style="color: #1f66af;">(</span>res <span style="color: #5f2fba;">(</span>plz 'get <span style="color: #003faf;">(</span>concat <span style="color: #006f70;">"http://web.juhe.cn/finance/gold/shgold?key=KEY&amp;v=1"</span><span style="color: #003faf;">)</span>
               <span style="color: #6a4a9f;">:as</span> #'json-read<span style="color: #5f2fba;">)</span><span style="color: #1f66af;">)</span><span style="color: #3a6f00;">)</span>
    <span style="color: #3a6f00;">(</span>concat prev <span style="color: #006f70;">" price AU "</span>
            <span style="color: #1f66af;">(</span>map-nested-elt res '<span style="color: #5f2fba;">(</span>result 0 Au100g yespri<span style="color: #5f2fba;">)</span><span style="color: #1f66af;">)</span>
            <span style="color: #006f70;">" CN"</span><span style="color: #3a6f00;">)</span><span style="color: #444fcf;">)</span><span style="color: #007047;">)</span>
</code></pre>
</div>

<p>
运行之后的结果：<br>
</p>
<div class="org-src-container">
<pre class="src src-beancount"><code><span style="color: #003faf;">2026-01-07</span> <span style="color: #444fcf;">price</span> AU <span style="color: #151a27; background-color: #edf4f8;">1000.24 CN</span>
</code></pre>
</div>

<p>
注：本文中代码需要安装<a href="https://github.com/alphapapa/plz.el">PLZ</a>包，还有启用map.el<br>
</p>

<div class="org-src-container">
<pre class="src src-elisp"><code><span style="color: #007047;">(</span><span style="color: #444fcf;">use-package</span> plz <span style="color: #6a4a9f;">:ensure</span> t <span style="color: #6a4a9f;">:demand</span> t<span style="color: #007047;">)</span>
<span style="color: #007047;">(</span><span style="color: #444fcf;">require</span> '<span style="color: #003faf;">map</span><span style="color: #007047;">)</span>
</code></pre>
</div>
</div>
<div id="postamble" class="status">
<p>© Published by <a href="https://www.gnu.org/software/emacs/">Emacs</a> 31.0.50 (<a href="https://orgmode.org">Org</a> mode 9.8-pre)　|　<a href="https://tomoemami.github.io/rss.xml">RSS</a>　<a href="https://tomoemami.github.io/20251121T151653--english-post-index__wiki.html">English-Index</a></p>
</div>
</body>
</html>
