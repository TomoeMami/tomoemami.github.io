<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2026-01-06 周二 17:27 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>emacs-将daily笔记以逆序datetree方式refile到另一个窗口</title>
<meta name="generator" content="Org Mode" />
<link rel='stylesheet' type='text/css' href='/org.css'/>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href=""> UP </a>
 |
 <a accesskey="H" href="index.html"> HOME </a>
</div><div id="preamble" class="status">
<p>▼ 本文更新于 <span class="timestamp-wrapper"><span class="timestamp">[2026-01-06 周二 17:09]</span></span></p>
</div>
<div id="content" class="content">
<header>
<h1 class="title">emacs-将daily笔记以逆序datetree方式refile到另一个窗口</h1>
</header><p>
<span class="timestamp-wrapper"><time class="timestamp" datetime="2024-04-07T10:12:00">[2024-04-07 周日 10:12]</time></span><br>
</p>

<p>
将daily笔记以逆序datetree方式refile到另一个窗口<br>
</p>

<p>
在左右并排的两个window间，会根据本buffer的title，将指定的headline refile到另一个窗口，并按reverse-datetree排列<br>
</p>

<div class="org-src-container">
<pre class="src src-elisp"><code><span style="color: #a7601f;">(</span><span style="color: #006f00;">use-package</span> org-reverse-datetree<span style="color: #a7601f;">)</span>
<span style="color: #a7601f;">(</span><span style="color: #006f00;">setq-default</span> org-reverse-datetree-level-formats
              '<span style="color: #557400;">(</span><span style="color: #ca3400;">"%Y"</span>                    <span style="color: #8f6f4a;">; </span><span style="color: #8f6f4a;">year
</span>                <span style="color: #ca3400;">"%Y-%m %B"</span>
                <span style="color: #ca3400;">"%Y-%m-%d %A"</span>           <span style="color: #8f6f4a;">; </span><span style="color: #8f6f4a;">date
</span>                <span style="color: #557400;">)</span><span style="color: #a7601f;">)</span>
<span style="color: #a7601f;">(</span><span style="color: #006f00;">defun</span> <span style="color: #a7601f;">org-get-next-window-file</span> <span style="color: #557400;">()</span>
  <span style="color: #557400;">(</span><span style="color: #006f00;">if</span> <span style="color: #bf4400;">(</span>delq <span style="color: #3f6faf;">(</span>selected-window<span style="color: #3f6faf;">)</span> <span style="color: #3f6faf;">(</span>window-list-1 <span style="color: #00824f;">(</span>next-window nil 'nomini 'visible<span style="color: #00824f;">)</span><span style="color: #3f6faf;">)</span><span style="color: #bf4400;">)</span>
      <span style="color: #bf4400;">(</span><span style="color: #006f00;">let</span> <span style="color: #3f6faf;">(</span><span style="color: #00824f;">(</span>buffer2 <span style="color: #9a456f;">(</span>window-buffer <span style="color: #a2604f;">(</span>next-window nil 'nomini 'visible<span style="color: #a2604f;">)</span><span style="color: #9a456f;">)</span><span style="color: #00824f;">)</span><span style="color: #3f6faf;">)</span>
        <span style="color: #3f6faf;">(</span><span style="color: #006f00;">with-current-buffer</span> buffer2
          <span style="color: #00824f;">(</span><span style="color: #006f00;">when</span> <span style="color: #9a456f;">(</span>eq major-mode 'org-mode<span style="color: #9a456f;">)</span>
            <span style="color: #9a456f;">(</span>buffer-file-name buffer2<span style="color: #9a456f;">)</span><span style="color: #00824f;">)</span><span style="color: #3f6faf;">)</span><span style="color: #bf4400;">)</span><span style="color: #557400;">)</span><span style="color: #a7601f;">)</span>
<span style="color: #a7601f;">(</span><span style="color: #006f00;">defun</span> <span style="color: #a7601f;">org-get-current-window-title</span> <span style="color: #557400;">()</span>
  <span style="color: #557400;">(</span><span style="color: #006f00;">with-current-buffer</span> <span style="color: #bf4400;">(</span>window-buffer<span style="color: #bf4400;">)</span>
        <span style="color: #bf4400;">(</span><span style="color: #006f00;">pcase</span> <span style="color: #3f6faf;">(</span>org-collect-keywords '<span style="color: #00824f;">(</span><span style="color: #ca3400;">"TITLE"</span><span style="color: #00824f;">)</span><span style="color: #3f6faf;">)</span>
          <span style="color: #3f6faf;">(</span>`<span style="color: #00824f;">(</span><span style="color: #9a456f;">(</span><span style="color: #ca3400;">"TITLE"</span> . ,val<span style="color: #9a456f;">)</span><span style="color: #00824f;">)</span>
           <span style="color: #00824f;">(</span><span style="color: #006f00;">setq</span> title <span style="color: #9a456f;">(</span>car val<span style="color: #9a456f;">)</span><span style="color: #00824f;">)</span><span style="color: #3f6faf;">)</span><span style="color: #bf4400;">)</span><span style="color: #557400;">)</span><span style="color: #a7601f;">)</span>
<span style="color: #a7601f;">(</span><span style="color: #006f00;">defun</span> <span style="color: #a7601f;">org-refile-to-other-window</span> <span style="color: #557400;">(</span>arg<span style="color: #557400;">)</span>
  <span style="color: #557400;">(</span><span style="color: #006f00;">interactive</span> <span style="color: #ca3400;">"P"</span><span style="color: #557400;">)</span>
  <span style="color: #557400;">(</span><span style="color: #006f00;">if</span> <span style="color: #bf4400;">(</span>org-get-next-window-file<span style="color: #bf4400;">)</span>
      <span style="color: #bf4400;">(</span>org-reverse-datetree-refile-to-file <span style="color: #3f6faf;">(</span>org-get-next-window-file<span style="color: #3f6faf;">)</span> <span style="color: #3f6faf;">(</span>date-to-time <span style="color: #00824f;">(</span>org-get-current-window-title<span style="color: #00824f;">)</span><span style="color: #3f6faf;">)</span><span style="color: #bf4400;">)</span>
        <span style="color: #557400;">)</span><span style="color: #a7601f;">)</span>
</code></pre>
</div>
</div>
<div id="postamble" class="status">
<p>© Published by <a href="https://www.gnu.org/software/emacs/">Emacs</a> 31.0.50 (<a href="https://orgmode.org">Org</a> mode 9.8-pre)　|　<a href="https://tomoemami.github.io/rss.xml">RSS</a>　<a href="https://tomoemami.github.io/20251121T151653--english-post-index__wiki.html">English-Index</a></p>
</div>
</body>
</html>
