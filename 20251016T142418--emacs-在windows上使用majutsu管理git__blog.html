<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2026-01-12 周一 13:53 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>emacs-在Windows上使用majutsu管理git</title>
<meta name="generator" content="Org Mode" />
<link rel='stylesheet' type='text/css' href='/org.css'/>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href=""> UP </a>
 |
 <a accesskey="H" href="index.html"> HOME </a>
</div><div id="preamble" class="status">
<p>▼ 本文更新于 <span class="timestamp-wrapper"><span class="timestamp">[2026-01-12 周一 13:52]</span></span></p>
</div>
<div id="content" class="content">
<header>
<h1 class="title">emacs-在Windows上使用majutsu管理git</h1>
</header><p>
想必使用Emacs的你，应该听说过Git。虽然功能强大且成为了现代社区开发的基石之一，但Git的使用难度着实不低。幸好，我们Emacs上有一个伟大的pcakage <a href="https://github.com/magit/magit">Magit</a> ，可以极大程度提升Git使用幸福度。<br>
</p>

<p>
然而在Windows上，Magit的性能相当差，根据<a href="https://github.com/magit/magit/discussions/5301">有关讨论</a>，主要是因为magit会运行大量 git 进程来收集所需信息，而Windows上创建进程的代价又相对较高。<br>
</p>

<p>
时间来到了2025年，在Rewrite It In Rust的风潮中，许多经典的Linux工具被Rust重写，而Git也有一个以Rust编写的相似软件：<a href="https://github.com/jj-vcs/jj">Jujutsu</a>。简单来说，jj能够管理Git的repo，采用了简化一点的设计思路，当然也有缺少的功能。不过最重要的是，在Windows上用Majutsu+Jujutsu比Magit+Git响应速度更快。<br>
</p>
<div id="outline-container-orgb38c0f9" class="outline-2">
<h2 id="orgb38c0f9"><span class="section-number-2">1.</span> 配置Git、Jujutsu</h2>
<div class="outline-text-2" id="text-1">
<p>
Jujutsu需要和Git一起安装，在管理repo之后也会调用Git进行push/fetch等操作。<br>
</p>

<p>
根据<a href="https://cevolve05.github.io/post/2024/10/05/fix-scoop-git-not-use-win32-openssh/">这篇帖子</a>，Windows上的Git不能用scoop安装，需要下载Installer，并在安装的过程中勾选「使用外部 OpenSSH」。如果你不幸通过scoop安装了，请卸载并改用<a href="https://gitforwindows.org/">官方的安装包</a>（否则你会发现jj无法push）。<br>
</p>

<p>
<span class="timestamp-wrapper"><time class="timestamp" datetime="2025-10-19T16:06:00">[2025-10-19 周日 16:06]</time></span>：<br>
使用外部SSH时，若要设置Git的代理，应手动指定 <code>connect.exe</code> 的路径，如：<br>
</p>

<p>
<code>Proxycommand C:\Program Files\Git\mingw64\bin\connect.exe -S 127.0.0.1:7890 %h %p</code> <br>
</p>

<p>
Jujutsu可以通过scoop安装，直接 <code>scoop install jj</code> 就行了。<br>
</p>
</div>
</div>
<div id="outline-container-orgf806ce9" class="outline-2">
<h2 id="orgf806ce9"><span class="section-number-2">2.</span> 配置majutsu</h2>
<div class="outline-text-2" id="text-2">
<p>
如果你用的emacs 30+ 的版本，可以用 <code>use-package</code> 的 <code>:vc</code> 关键字直接从Github Repo安装Majutsu。<br>
</p>
<div class="org-src-container">
<pre class="src src-elisp"><code><span style="color: #007a85;">(</span><span style="color: #004fc0;">use-package</span> majutsu
  <span style="color: #1f6fbf;">:vc</span> <span style="color: #004fc0;">(</span><span style="color: #1f6fbf;">:url</span> <span style="color: #4244ef;">"https://github.com/0WD0/majutsu"</span>
            <span style="color: #1f6fbf;">:rev</span> <span style="color: #1f6fbf;">:newest</span><span style="color: #004fc0;">)</span>
  <span style="color: #1f6fbf;">:bind</span>
  <span style="color: #004fc0;">(</span><span style="color: #00845f;">(</span><span style="color: #4244ef;">"C-x j"</span> . majutsu-log<span style="color: #00845f;">)</span>
   <span style="color: #00845f;">(</span><span style="color: #4244ef;">"C-x C-j"</span> . majutsu-log<span style="color: #00845f;">)</span><span style="color: #004fc0;">)</span><span style="color: #007a85;">)</span>
</code></pre>
</div>

<p>
不然的话，也可以用其他方式，或者手动下载相关文件。<br>
</p>
</div>
</div>
<div id="outline-container-org74af698" class="outline-2">
<h2 id="org74af698"><span class="section-number-2">3.</span> 使用majutsu</h2>
<div class="outline-text-2" id="text-3">
<p>
<code>C-x j</code> 进入majutsu界面。jujutsu的思路和git不一样，取消了暂存区等功能，当前文件的状态是一个未命名的新HEAD，commit之后就会固定。<br>
</p>

<p>
一个简单的工作流程是：<br>
</p>

<p>
在当前repo里进行一些变更，等觉得应该保存当前状态了，就 <code>C-x j</code> 然后 <code>c</code> ，输入commit内容，生成一个commit。<br>
</p>

<p>
如果想上传了，就 <code>C-x j</code> 然后将光标移动至想更新到的commit上，再 <code>b</code> <code>s</code> ，将 <code>main</code> 移动过来，最后 <code>G</code> <code>p</code> <code>p</code> 推送。<br>
</p>

<p>
更详细的介绍，请看下面两个教程：<br>
</p>

<p>
<a href="https://maddie.wtf/posts/2025-07-21-jujutsu-for-busy-devs">忙碌开发者的jujutsu教程</a><br>
</p>

<p>
<a href="https://jj-for-everyone.github.io/introduction.html">每个人的jujutsu教程</a><br>
</p>

<p>
<span class="timestamp-wrapper"><time class="timestamp" datetime="2025-10-31">[2025-10-31 周五]</time></span> 下面我用几个实际案例说明一下操作。<br>
</p>
</div>
<div id="outline-container-org45420ee" class="outline-3">
<h3 id="org45420ee"><span class="section-number-3">3.1.</span> 初始化</h3>
<div class="outline-text-3" id="text-3-1">
<p>
这一步需要在cmd/pwsh中进行。以下均假设默认branch为 <code>main</code> 。<br>
</p>

<p>
如果需要从头clone一个repo：<br>
</p>
<div class="org-src-container">
<pre class="src src-bash"><code>jj git clone --colocate REPO-URL
</code></pre>
</div>

<p>
如果本地已经有一个git的repo，则需要在初始化之后明确追踪 <code>main@origin</code> （根据实际情况的主要分支而定）：<br>
</p>
<div class="org-src-container">
<pre class="src src-bash"><code>jj git init --colocate
jj bookmark track main@origin
</code></pre>
</div>
</div>
</div>
<div id="outline-container-orgc3c31b2" class="outline-3">
<h3 id="orgc3c31b2"><span class="section-number-3">3.2.</span> 保存变更为commit</h3>
<div class="outline-text-3" id="text-3-2">
<p>
在当前repo里进行一些变更，等觉得应该保存当前状态了，就 <code>C-x j</code> 然后 <code>c</code> ，输入commit内容， <code>C-c C-c</code> 保存并生成一个commit。<br>
</p>
</div>
</div>
<div id="outline-container-org172a176" class="outline-3">
<h3 id="org172a176"><span class="section-number-3">3.3.</span> 将本地commit上传</h3>
<div class="outline-text-3" id="text-3-3">
<p>
<code>C-x j</code> 进入Majutsu界面，然后将光标移动至想更新到的commit上，再 <code>b</code> <code>s</code> ，将 <code>main</code> 移动过来，最后 <code>G</code> <code>p</code> <code>p</code> 推送。<br>
</p>
</div>
</div>
<div id="outline-container-org78eb700" class="outline-3">
<h3 id="org78eb700"><span class="section-number-3">3.4.</span> 拉取并merge远端</h3>
<div class="outline-text-3" id="text-3-4">
<p>
由于没有新branch，默认是采取的rebase方法。<br>
<code>C-x j</code> 进入Majutsu界面，然后 <code>G</code> <code>f</code> <code>f</code> fetch远端，再 <code>r</code> 进入rebase界面，移动光标到本地commit，按 <code>s</code> 将其选为起点，再移动光标到fetch的远端commit，按 <code>d</code> 将其选为终点，最后按 <code>r</code> 确认rebase。<br>
</p>
</div>
</div>
<div id="outline-container-orgfffca92" class="outline-3">
<h3 id="orgfffca92"><span class="section-number-3">3.5.</span> 放弃本地变更</h3>
<div class="outline-text-3" id="text-3-5">
<p>
有的时候需要放弃本地变更。只能放弃可变的变更（非菱形图标），将光标移动到该commit上，按 <code>a</code> 再按 <code>y</code> 就能放弃。<br>
</p>
</div>
</div>
</div>
<div id="outline-container-orgaf27202" class="outline-2">
<h2 id="orgaf27202"><span class="section-number-2">4.</span> 后记</h2>
<div class="outline-text-2" id="text-4">
<p>
<span class="timestamp-wrapper"><time class="timestamp" datetime="2026-01-12T13:49:00">[2026-01-12 周一 13:49]</time></span> 由于我主要用jj管理.emacs.d，很少用到其他功能，因此使用懒猫的<a href="https://github.com/manateelazycat/one-key">one-key</a>来简化操作，放弃了 <code>majutsu</code> 。<br>
</p>
<div class="org-src-container">
<pre class="src src-elisp"><code><span style="color: #007a85;">(</span><span style="color: #004fc0;">use-package</span> with-editor
  <span style="color: #1f6fbf;">:ensure</span> t <span style="color: #1f6fbf;">:demand</span> t
  <span style="color: #1f6fbf;">:config</span>
  <span style="color: #004fc0;">(</span><span style="color: #004fc0;">defun</span> <span style="color: #00845f;">my/setup-editor-buffer</span> <span style="color: #00845f;">()</span>
    <span style="color: #00845f;">(</span><span style="color: #004fc0;">when</span> <span style="color: #7f5ae0;">(</span>string-prefix-p <span style="color: #4244ef;">"editor-"</span> <span style="color: #1f6fbf;">(</span>buffer-name<span style="color: #1f6fbf;">)</span><span style="color: #7f5ae0;">)</span>
      <span style="color: #7f5ae0;">(</span>with-editor-mode 1<span style="color: #7f5ae0;">)</span><span style="color: #00845f;">)</span><span style="color: #004fc0;">)</span>
  <span style="color: #1f6fbf;">:hook</span>
  <span style="color: #004fc0;">(</span>server-visit-hook . my/setup-editor-buffer<span style="color: #004fc0;">)</span><span style="color: #007a85;">)</span>
<span style="color: #007a85;">(</span><span style="color: #004fc0;">defun</span> <span style="color: #00845f;">my/personal-jj</span> <span style="color: #004fc0;">(</span>action<span style="color: #004fc0;">)</span>
  <span style="color: #004fc0;">(</span><span style="color: #004fc0;">let*</span> <span style="color: #00845f;">(</span><span style="color: #7f5ae0;">(</span>emacs-exe <span style="color: #1f6fbf;">(</span><span style="color: #004fc0;">if</span> <span style="color: #4244ef;">(</span>eq system-type 'windows-nt<span style="color: #4244ef;">)</span>
                        <span style="color: #4244ef;">"emacsclientw"</span>
                      <span style="color: #4244ef;">"emacsclient"</span><span style="color: #1f6fbf;">)</span><span style="color: #7f5ae0;">)</span>
         <span style="color: #7f5ae0;">(</span>args <span style="color: #4244ef;">" --no-pager"</span><span style="color: #7f5ae0;">)</span>
         <span style="color: #7f5ae0;">(</span>str
          <span style="color: #1f6fbf;">(</span><span style="color: #004fc0;">cond</span> <span style="color: #4244ef;">(</span><span style="color: #468400;">(</span>eq action 'push<span style="color: #468400;">)</span>
                 <span style="color: #4244ef;">"jj b s main &amp;&amp; jj git push"</span><span style="color: #4244ef;">)</span>
                <span style="color: #4244ef;">(</span><span style="color: #468400;">(</span>eq action 'fetch<span style="color: #468400;">)</span>
                 <span style="color: #4244ef;">"jj git fetch &amp;&amp; jj rebase -d main"</span><span style="color: #4244ef;">)</span>
                <span style="color: #4244ef;">(</span><span style="color: #468400;">(</span>eq action 'commit<span style="color: #468400;">)</span>
                 <span style="color: #4244ef;">"jj commit"</span><span style="color: #4244ef;">)</span>
                <span style="color: #4244ef;">(</span><span style="color: #468400;">(</span>eq action 'squash<span style="color: #468400;">)</span>
                 <span style="color: #4244ef;">"jj squash"</span><span style="color: #4244ef;">)</span>
                <span style="color: #4244ef;">(</span><span style="color: #468400;">(</span>eq action 'describe<span style="color: #468400;">)</span>
                 <span style="color: #4244ef;">"jj describe"</span><span style="color: #4244ef;">)</span>
                <span style="color: #4244ef;">(</span><span style="color: #468400;">(</span>eq action 'log<span style="color: #468400;">)</span>
                 <span style="color: #4244ef;">"jj log"</span><span style="color: #4244ef;">)</span>
                <span style="color: #4244ef;">(</span><span style="color: #468400;">(</span>eq action 'status<span style="color: #468400;">)</span>
                 <span style="color: #4244ef;">"jj status"</span><span style="color: #4244ef;">)</span>
                <span style="color: #4244ef;">(</span><span style="color: #468400;">(</span>eq action 'abandon<span style="color: #468400;">)</span>
                 <span style="color: #468400;">(</span>concat <span style="color: #4244ef;">"jj abandon "</span> <span style="color: #aa44c5;">(</span>read-string <span style="color: #4244ef;">"Abandon: "</span><span style="color: #aa44c5;">)</span><span style="color: #468400;">)</span><span style="color: #4244ef;">)</span>
                <span style="color: #4244ef;">(</span><span style="color: #468400;">(</span>eq action 'edit<span style="color: #468400;">)</span>
                 <span style="color: #468400;">(</span>concat <span style="color: #4244ef;">"jj edit "</span> <span style="color: #aa44c5;">(</span>read-string <span style="color: #4244ef;">"Edit: "</span><span style="color: #aa44c5;">)</span><span style="color: #468400;">)</span><span style="color: #4244ef;">)</span><span style="color: #1f6fbf;">)</span><span style="color: #7f5ae0;">)</span>
         <span style="color: #7f5ae0;">(</span>process-environment <span style="color: #1f6fbf;">(</span>cons <span style="color: #4244ef;">(</span>concat <span style="color: #4244ef;">"JJ_EDITOR="</span> emacs-exe<span style="color: #4244ef;">)</span> process-environment<span style="color: #1f6fbf;">)</span><span style="color: #7f5ae0;">)</span><span style="color: #00845f;">)</span>
    <span style="color: #00845f;">(</span>async-shell-command <span style="color: #7f5ae0;">(</span>concat str args<span style="color: #7f5ae0;">)</span> <span style="color: #4244ef;">"*JJ*"</span><span style="color: #00845f;">)</span><span style="color: #004fc0;">)</span><span style="color: #007a85;">)</span>

<span style="color: #007a85;">(</span><span style="color: #004fc0;">use-package</span> one-key <span style="color: #1f6fbf;">:demand</span> t
  <span style="color: #1f6fbf;">:vc</span> <span style="color: #004fc0;">(</span><span style="color: #1f6fbf;">:url</span> <span style="color: #4244ef;">"git@github.com:manateelazycat/one-key"</span>
           <span style="color: #1f6fbf;">:rev</span> <span style="color: #1f6fbf;">:newest</span><span style="color: #004fc0;">)</span><span style="color: #007a85;">)</span>
<span style="color: #007a85;">(</span><span style="color: #004fc0;">one-key-create-menu</span>
 <span style="color: #4244ef;">"GIT"</span>
 '<span style="color: #004fc0;">(</span>
   <span style="color: #00845f;">(</span><span style="color: #7f5ae0;">(</span><span style="color: #4244ef;">"p"</span> . <span style="color: #4244ef;">"Push"</span><span style="color: #7f5ae0;">)</span> . <span style="color: #7f5ae0;">(</span><span style="color: #004fc0;">lambda</span> <span style="color: #1f6fbf;">()</span> <span style="color: #1f6fbf;">(</span><span style="color: #004fc0;">interactive</span><span style="color: #1f6fbf;">)</span> <span style="color: #1f6fbf;">(</span>my/personal-jj 'push<span style="color: #1f6fbf;">)</span><span style="color: #7f5ae0;">)</span><span style="color: #00845f;">)</span>
   <span style="color: #00845f;">(</span><span style="color: #7f5ae0;">(</span><span style="color: #4244ef;">"f"</span> . <span style="color: #4244ef;">"Fetch"</span><span style="color: #7f5ae0;">)</span> . <span style="color: #7f5ae0;">(</span><span style="color: #004fc0;">lambda</span> <span style="color: #1f6fbf;">()</span> <span style="color: #1f6fbf;">(</span><span style="color: #004fc0;">interactive</span><span style="color: #1f6fbf;">)</span> <span style="color: #1f6fbf;">(</span>my/personal-jj 'fetch<span style="color: #1f6fbf;">)</span><span style="color: #7f5ae0;">)</span><span style="color: #00845f;">)</span>
   <span style="color: #00845f;">(</span><span style="color: #7f5ae0;">(</span><span style="color: #4244ef;">"g"</span> . <span style="color: #4244ef;">"Status"</span><span style="color: #7f5ae0;">)</span> . <span style="color: #7f5ae0;">(</span><span style="color: #004fc0;">lambda</span> <span style="color: #1f6fbf;">()</span> <span style="color: #1f6fbf;">(</span><span style="color: #004fc0;">interactive</span><span style="color: #1f6fbf;">)</span> <span style="color: #1f6fbf;">(</span>my/personal-jj 'status<span style="color: #1f6fbf;">)</span><span style="color: #7f5ae0;">)</span><span style="color: #00845f;">)</span>
   <span style="color: #00845f;">(</span><span style="color: #7f5ae0;">(</span><span style="color: #4244ef;">"d"</span> . <span style="color: #4244ef;">"Describe"</span><span style="color: #7f5ae0;">)</span> . <span style="color: #7f5ae0;">(</span><span style="color: #004fc0;">lambda</span> <span style="color: #1f6fbf;">()</span> <span style="color: #1f6fbf;">(</span><span style="color: #004fc0;">interactive</span><span style="color: #1f6fbf;">)</span> <span style="color: #1f6fbf;">(</span>my/personal-jj 'describe<span style="color: #1f6fbf;">)</span><span style="color: #7f5ae0;">)</span><span style="color: #00845f;">)</span>
   <span style="color: #00845f;">(</span><span style="color: #7f5ae0;">(</span><span style="color: #4244ef;">"l"</span> . <span style="color: #4244ef;">"Log"</span><span style="color: #7f5ae0;">)</span> . <span style="color: #7f5ae0;">(</span><span style="color: #004fc0;">lambda</span> <span style="color: #1f6fbf;">()</span> <span style="color: #1f6fbf;">(</span><span style="color: #004fc0;">interactive</span><span style="color: #1f6fbf;">)</span> <span style="color: #1f6fbf;">(</span>my/personal-jj 'log<span style="color: #1f6fbf;">)</span><span style="color: #7f5ae0;">)</span><span style="color: #00845f;">)</span>
   <span style="color: #00845f;">(</span><span style="color: #7f5ae0;">(</span><span style="color: #4244ef;">"q"</span> . <span style="color: #4244ef;">"sQuash"</span><span style="color: #7f5ae0;">)</span> . <span style="color: #7f5ae0;">(</span><span style="color: #004fc0;">lambda</span> <span style="color: #1f6fbf;">()</span> <span style="color: #1f6fbf;">(</span><span style="color: #004fc0;">interactive</span><span style="color: #1f6fbf;">)</span> <span style="color: #1f6fbf;">(</span>my/personal-jj 'squash<span style="color: #1f6fbf;">)</span><span style="color: #7f5ae0;">)</span><span style="color: #00845f;">)</span>
   <span style="color: #00845f;">(</span><span style="color: #7f5ae0;">(</span><span style="color: #4244ef;">"a"</span> . <span style="color: #4244ef;">"Abandon"</span><span style="color: #7f5ae0;">)</span> . <span style="color: #7f5ae0;">(</span><span style="color: #004fc0;">lambda</span> <span style="color: #1f6fbf;">()</span> <span style="color: #1f6fbf;">(</span><span style="color: #004fc0;">interactive</span><span style="color: #1f6fbf;">)</span> <span style="color: #1f6fbf;">(</span>my/personal-jj 'abandon<span style="color: #1f6fbf;">)</span><span style="color: #7f5ae0;">)</span><span style="color: #00845f;">)</span>
   <span style="color: #00845f;">(</span><span style="color: #7f5ae0;">(</span><span style="color: #4244ef;">"e"</span> . <span style="color: #4244ef;">"Edit"</span><span style="color: #7f5ae0;">)</span> . <span style="color: #7f5ae0;">(</span><span style="color: #004fc0;">lambda</span> <span style="color: #1f6fbf;">()</span> <span style="color: #1f6fbf;">(</span><span style="color: #004fc0;">interactive</span><span style="color: #1f6fbf;">)</span> <span style="color: #1f6fbf;">(</span>my/personal-jj 'edit<span style="color: #1f6fbf;">)</span><span style="color: #7f5ae0;">)</span><span style="color: #00845f;">)</span>
   <span style="color: #00845f;">(</span><span style="color: #7f5ae0;">(</span><span style="color: #4244ef;">"c"</span> . <span style="color: #4244ef;">"Commit"</span><span style="color: #7f5ae0;">)</span> . <span style="color: #7f5ae0;">(</span><span style="color: #004fc0;">lambda</span> <span style="color: #1f6fbf;">()</span> <span style="color: #1f6fbf;">(</span><span style="color: #004fc0;">interactive</span><span style="color: #1f6fbf;">)</span> <span style="color: #1f6fbf;">(</span>my/personal-jj 'commit<span style="color: #1f6fbf;">)</span><span style="color: #7f5ae0;">)</span><span style="color: #00845f;">)</span><span style="color: #004fc0;">)</span>
 t<span style="color: #007a85;">)</span>
<span style="color: #007a85;">(</span>global-set-key <span style="color: #4244ef;">"\C-cg"</span> #'one-key-menu-git<span style="color: #007a85;">)</span>
</code></pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p>© Published by <a href="https://www.gnu.org/software/emacs/">Emacs</a> 31.0.50 (<a href="https://orgmode.org">Org</a> mode 9.8-pre)　|　<a href="https://blog.prayhand13013.top/rss.xml">RSS</a>　<a href="https://blog.prayhand13013.top/20251121T151653--english-post-index__wiki.html">English-Index</a></p>
</div>
</body>
</html>
