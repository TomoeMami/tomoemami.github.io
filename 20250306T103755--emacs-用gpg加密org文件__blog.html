<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2026-01-06 周二 17:28 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>emacs-用gpg加密org文件</title>
<meta name="generator" content="Org Mode" />
<link rel='stylesheet' type='text/css' href='/org.css'/>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href=""> UP </a>
 |
 <a accesskey="H" href="index.html"> HOME </a>
</div><div id="preamble" class="status">
<p>▼ 本文更新于 <span class="timestamp-wrapper"><span class="timestamp">[2026-01-06 周二 17:26]</span></span></p>
</div>
<div id="content" class="content">
<header>
<h1 class="title">emacs-用gpg加密org文件</h1>
</header><p>
<span class="timestamp-wrapper"><time class="timestamp" datetime="2025-03-06T10:37:00">[2025-03-06 周四 10:37]</time></span><br>
</p>
<div id="outline-container-orgf1d4f0e" class="outline-2">
<h2 id="orgf1d4f0e"><span class="section-number-2">1.</span> 安装GPG</h2>
<div class="outline-text-2" id="text-1">
<p>
Linux/MacOS不用多谈，Windows上最简单的就是用 <code>scoop install gpg</code> 安装 <code>gpg</code> ，然后重启电脑，确保Emacs的 <code>shell</code> 重载环境变量。<br>
</p>
</div>
</div>
<div id="outline-container-orgb282081" class="outline-2">
<h2 id="orgb282081"><span class="section-number-2">2.</span> 使用GPG加密</h2>
<div class="outline-text-2" id="text-2">
<p>
参见这篇<a href="https://orgmode.org/worg/org-tutorials/encrypting-files.html">Worg指南</a><br>
</p>

<p>
使用密钥的好处是可以利用gpg的缓存功能，减少保存时的密码输入。尤其在使用多个GPG文件时，优势尽显。<br>
</p>

<p>
导入密钥：<br>
</p>
<div class="org-src-container">
<pre class="src src-bash"><code>gpg --full-gen-key

<span style="color: #8f6f4a;">#</span><span style="color: #8f6f4a;">&#29983;&#25104;&#26102;&#20250;&#35201;&#27714;&#36755;&#20837;name
</span>
<span style="color: #8f6f4a;">#</span><span style="color: #8f6f4a;">&#23548;&#20986;&#31169;&#38053;
</span>gpg --armor --output name.key --export-secret-keys

<span style="color: #8f6f4a;">#</span><span style="color: #8f6f4a;">&#23548;&#20837;&#31169;&#38053;
</span>gpg --import name.key

<span style="color: #8f6f4a;">#</span><span style="color: #8f6f4a;">&#20449;&#20219;&#31169;&#38053;
</span>gpg --edit-key name
<span style="color: #8f6f4a;"># </span><span style="color: #8f6f4a;">&#30475;&#21040;&#25552;&#31034;&#31526;&#21518;&#36755;&#20837; trust
</span><span style="color: #8f6f4a;"># </span><span style="color: #8f6f4a;">&#20877;&#36873;&#25321;&#20449;&#20219;&#31561;&#32423;&#65292;&#25105;&#33258;&#24049;&#30340; Key&#65292;&#25105;&#36873; 5</span>
</code></pre>
</div>

<p>
注意：不要使用类似 <code>gpg --armor --export-key XYZ &gt;pubkey_xyz.asc</code> 这样的 Powershell 重定向，将导致生成一个 gpg 无法导入的文本文件（<a href="https://forum.gnupg.org/t/does-exporting-a-public-key-on-windows-11-on-the-command-line-lead-to-a-broken-file-utf-16-le/4520">来源</a>）。<br>
</p>
</div>
</div>
<div id="outline-container-org1a74e34" class="outline-2">
<h2 id="org1a74e34"><span class="section-number-2">3.</span> 其他设置</h2>
<div class="outline-text-2" id="text-3">
<p>
如果使用了 <code>org-crypt</code> ，需要关闭自动的backup文件：<br>
</p>

<div class="org-src-container">
<pre class="src src-elisp"><code><span style="color: #a7601f;">(</span><span style="color: #006f00;">setq</span> make-backup-files nil<span style="color: #a7601f;">)</span>
</code></pre>
</div>

<p>
同时，如果在Windows上使用，还需注意 <code>utf-8-dos</code> 导致的换行符问题，需要进行一下包装：<br>
</p>

<div class="org-src-container">
<pre class="src src-elisp"><code><span style="color: #a7601f;">(</span><span style="color: #006f00;">defun</span> <span style="color: #a7601f;">my/org-encrypt-entries</span> <span style="color: #557400;">()</span>
  <span style="color: #557400;">(</span><span style="color: #006f00;">interactive</span><span style="color: #557400;">)</span>
  <span style="color: #557400;">(</span>org-encrypt-entries<span style="color: #557400;">)</span>
  <span style="color: #ca3400;">"&#31227;&#38500;&#34892;&#23614; ^M(CRLF) Replace DOS eolns CR LF with Unix eolns CR"</span>
  <span style="color: #557400;">(</span><span style="color: #006f00;">save-excursion</span>
    <span style="color: #bf4400;">(</span>goto-char <span style="color: #3f6faf;">(</span>point-min<span style="color: #3f6faf;">)</span><span style="color: #bf4400;">)</span>
    <span style="color: #bf4400;">(</span><span style="color: #006f00;">while</span> <span style="color: #3f6faf;">(</span>search-forward <span style="color: #ca3400;">"\r"</span> nil t<span style="color: #3f6faf;">)</span> <span style="color: #3f6faf;">(</span>replace-match <span style="color: #ca3400;">""</span><span style="color: #3f6faf;">)</span><span style="color: #bf4400;">)</span><span style="color: #557400;">)</span><span style="color: #a7601f;">)</span>
</code></pre>
</div>

<p>
如果使用了懒猫的 <code>auto-save</code> ，需要设置取消自动保存GPG文件：<br>
</p>

<div class="org-src-container">
<pre class="src src-elisp"><code><span style="color: #8f6f4a;">;;; </span><span style="color: #8f6f4a;">custom predicates if you don't want auto save.
</span><span style="color: #8f6f4a;">;;; </span><span style="color: #8f6f4a;">disable auto save mode when current filetype is an gpg file.
</span><span style="color: #a7601f;">(</span><span style="color: #006f00;">setq</span> auto-save-disable-predicates
      '<span style="color: #557400;">(</span><span style="color: #bf4400;">(</span><span style="color: #006f00;">lambda</span> <span style="color: #3f6faf;">()</span>
      <span style="color: #3f6faf;">(</span>string-suffix-p
      <span style="color: #ca3400;">"gpg"</span>
      <span style="color: #00824f;">(</span>file-name-extension <span style="color: #9a456f;">(</span>buffer-name<span style="color: #9a456f;">)</span><span style="color: #00824f;">)</span> t<span style="color: #3f6faf;">)</span><span style="color: #bf4400;">)</span><span style="color: #557400;">)</span><span style="color: #a7601f;">)</span>
</code></pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p>© Published by <a href="https://www.gnu.org/software/emacs/">Emacs</a> 31.0.50 (<a href="https://orgmode.org">Org</a> mode 9.8-pre)　|　<a href="https://tomoemami.github.io/rss.xml">RSS</a>　<a href="https://tomoemami.github.io/20251121T151653--english-post-index__wiki.html">English-Index</a></p>
</div>
</body>
</html>
