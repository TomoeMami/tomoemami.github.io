<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2025-11-28 五 20:01 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Emacs: Adding Chinese Lunar Calendar Anniversaries</title>
<meta name="author" content="ahs" />
<meta name="generator" content="Org Mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
/*@import url("https://fonts.googleapis.com/css2?family=Lora:wght@500&display=fallback");
@import url("https://fonts.googleapis.com/css2?family=Inconsolata&display=fallback");
*/

body {
    margin: 2% auto;
    width: 100%;
    max-width: 100%;
    background-color: rgba(242,229,188,0.5);
    /* background-color: rgba(255,255,255,0.5); */
    font-size: 18px;
    line-height: 1.4em;
}
@media screen and (min-width: 600px) {
    body {
        font-size: 18px;
    }
}

@media screen and (min-width: 910px) {
    body {
        width: 900px;
    }
}
#preamble {
    width: 80%;
    max-width: 980px;
    text-align: left;
    margin: auto;
    font-size: 80%;
}

hr {
    border: none;
    border-top: 5px double #333;
    margin: 0px 0;
}

.button {
    border: none;
    color: black;
    padding: 6px 14px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    margin: 4px 2px;
    transition-duration: 0.4s;
    cursor: pointer;
}

.button:hover {
    background-color: #3a1616;
    color: white;
}

.todo {
    background-color: #9d0006;
    color: #fbf1c7;
    padding: .1em 0.3em;
    border-radius: 3px;
    background-clip: padding-box;
    font-size: $code-size;
    font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;
    line-height: 1;
}

.done {
    background-color: #427b58;
    color: #fbf1c7;
    padding: .1em 0.3em;
    border-radius: 3px;
    background-clip: padding-box;
    font-size: $code-size;
    font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;
    line-height: 1;
}

#postamble p {
    font-size: 80%;
    margin: .2em;
    text-align: center;
}

#content, .content {
    width: 80%;
    max-width: 980px;
    margin: auto;
}

#org-div-home-and-up{
    position: fixed;
    right: 0.5em;
    margin-top: 70px;
    font-family:sans-serif;
}

#table-of-contents {
    margin-top: 105px;
    font-size: 12pt;
    position: fixed;
    left: 0em;
    top: 0em;
    background: white;
    max-height: 80%;
    overflow: auto;
}

#table-of-contents h2 {
    display: none;
}
#table-of-contents li {
    clear: both;
}
.timestamp {
    color: #928374;
    font-size: $smaller;
}

.timestamp-kwd {
    color: #5f9ea0;
}

@media screen and (max-width: 1200px) {
    #table-of-contents {
        position: relative;
        margin-top: 0px;
    }
}

/* p:not(blockquote > p) :not(ol > p) { */
/*     text-indent: 2em; */
/* } */
p {
    margin: 1em auto;
}

.title {
    font-size: 30px;
    line-height: 1.3;
    font-weight: bold;
    color: #0c2340;
}

h2:not(#table-of-contents > h2) {
    font-size: 30px;
    line-height: 1.2;
    position: relative;
    color: #204060;
}

h2::after {
    content: "";
    position: absolute;
    left: 0;
    bottom: 0;
    width: 100%;
    height: 2px;
    background-color: black;
}

h3:not(#table-of-contents > h3) {
    font-size: 20px;
    line-height: 1.1;
    position: relative;
    color: #4b748d;
}

h3::after {
    content: "";
    position: absolute;
    left: 0;
    bottom: 0;
    width: 100%;
    height: 2px;
    /* border-bottom: 1px dashed black; */
}

h4 {
    font-size: 14px;
    line-height: 1.1;
    font-weight: bold;
}

details {
  padding: .7em 1em .5em;
  border-radius: 15px;
  font-size: 0.95em;
  border: 2px solid #ccc;
  /* border-color: light-dark(var(--color-border), var(--dark-color-border)); */
  margin-block: 1em;
}

a {
    cursor: pointer;
    text-decoration: none;
}

a:link {
    color: #458588;
    /* text-decoration: underline; */
}

a:hover {
    /* font-weight: bold; */
    text-decoration: underline;
    /* color: #076678; */
}

.figure {
    text-align: center;
}

a:visited{
    color: #8f3f71;
    /* text-decoration: underline; */
}

img {
    max-width: 100%;
    vertical-align: middle;
}
.MathJax_Display {
    margin: 0!important;
    width: $smaller!important;
}
@media screen and (max-width: 1200px) {
    img {
        width: 400px;
    }
    .MathJax_Display {
        margin: 0!important;
        width: $smaller!important;
    }
}

.org-src-container {
    font-size: 14px;
    outline: 2px dashed #ccc;
    outline-offset: 10px;
    position: relative;

}
.org-src-container>pre {
    overflow: auto;
    font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Cascadia Code,Consolas, Liberation Mono, monospace;
}

.org-src-container>pre:before {
    display: block;
    position: absolute;
    background-color: #b3b3b3;
    top: 0;
    right: 0;
    padding: 0 0.5em;
    border-bottom-left-radius: 8px;
    border: 0;
    color: white;
    font-size: $code-size;

}
pre {
    overflow: auto;

}
.example{
    font-size: 14px;
    outline: 2px dashed #ccc;
    outline-offset: 10px;
    position: relative;
    
}
.example::before {
    content: "Results";
}
pre:before {
    display: block;
    position: absolute;
    background-color: #b3b3b3;
    top: 0;
    right: 0;
    padding: 0 0.5em;
    border-bottom-left-radius: 8px;
    border: 0;
    color: white;
    font-size: $code-size;
}
/* .org-src-container::before { */
/*     content: "Copy"; */
/*     position: absolute; */
/*     top: 5px; */
/*     right: 5px; */
/*     padding: 5px; */
/*     background-color: #ccc; */
/*     color: #fff; */
/*     border-radius: 3px; */
/*     cursor: pointer; */
/* } */

code {
    font-size: 16px;
    color: #427b58;
    font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Cascadia Code,Consolas, Liberation Mono, monospace;
}

.subtitle {
    text-align: right;
}

blockquote {
    border-left: 3px solid #ccc;
    padding-left: 10px; /* Optional: add some left padding for the content */
    margin-inline-start: 0px;
    margin-inline-end: 0px;
}

.info {
    overflow: hidden;
}

.created {
    float: right;
}

.updated {
    float: left;
}

.org-ol {
    list-style-type: decimal; /* Set the list style type to decimal numbers */
    /* margin-left: 0.5em; /\* Add left margin to the list *\/ */
}

b {
    color: #9d0006;
}

#footnotes {
    position: fixed;
    left: auto;
    right: 0;
    top: 105px;
    bottom: 0;
    width: 20%;
    padding: 10px;
    overflow: auto;
    font-size: 14px;
    z-index: 9999;
}

#footnotes h2 {
    display: none;
}

@media screen and (max-width: 1200px) {
    #footnotes {
        position: static;
        left: 0;
        right: 0;
        bottom: 0;
        width: 100%;
        max-height: 30%;
        overflow: auto;
        padding: 10px;
        font-size: 14px;
        z-index: 9999;
    }
}
/*]]>*/-->
 </style>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href=""> UP </a>
 |
 <a accesskey="H" href="index.html"> HOME </a>
</div><div id="preamble" class="status">
<p>▼ 本文更新于 <span class="timestamp-wrapper"><span class="timestamp">[2025-11-26 三 17:37]</span></span></p>
</div>
<div id="content" class="content">
<header>
<h1 class="title">Emacs: Adding Chinese Lunar Calendar Anniversaries</h1>
</header><p>
<span class="timestamp-wrapper"><time class="timestamp" datetime="2024-04-26T09:00:00">[2024-04-26 五 09:00]</time></span><br>
</p>

<p>
Anniversaries can be displayed in the <code>org-agenda</code>. To add a Gregorian anniversary, you can insert the following code into a new line in one of your <code>org-agenda-files</code> (note that ISO date format is enabled here):<br>
</p>

<div class="org-src-container">
<pre class="src src-elisp"><code><span style="color: #7a5f2f;">;; </span><span style="color: #7a5f2f;">Enable ISO date style: Year Month Day
</span><span style="color: #007a85;">(</span><span style="color: #004fc0;">setq</span> calendar-date-style 'iso<span style="color: #007a85;">)</span>

%%<span style="color: #007a85;">(</span>diary-anniversary 1949 10 1<span style="color: #007a85;">)</span> The %dth Gregorian birthday of New China
</code></pre>
</div>

<p>
On October 1st, it will appear at the bottom of the daily schedule in the <code>org-agenda</code> as follows:<br>
</p>

<div class="org-src-container">
<pre class="src src-nil"><code>The 75th Gregorian birthday of New China
</code></pre>
</div>

<p>
Adding anniversaries based on the Lunar (Chinese) calendar requires a different function, <code>diary-chinese-anniversary</code>. However, the third optional argument <code>year</code> accepted by this function is a combination of the cycle number and the year index within the Chinese sexagenary cycle, meaning you cannot simply input the Gregorian year.<br>
</p>

<p>
Taking the Lunar date of the 10th day of the 8th month, 1949 (which corresponds to October 1, 1949, in the Gregorian calendar) as an example, here is the setup (using ISO date style):<br>
</p>

<div class="org-src-container">
<pre class="src src-elisp"><code><span style="color: #7a5f2f;">;; </span><span style="color: #7a5f2f;">Enable ISO date style: Year Month Day
</span><span style="color: #007a85;">(</span><span style="color: #004fc0;">setq</span> calendar-date-style 'iso<span style="color: #007a85;">)</span>

<span style="color: #7a5f2f;">;; </span><span style="color: #7a5f2f;">Enable the built-in cal-china package
</span><span style="color: #007a85;">(</span><span style="color: #004fc0;">require</span> '<span style="color: #065fff;">cal-china</span><span style="color: #007a85;">)</span>

<span style="color: #7a5f2f;">;; </span><span style="color: #7a5f2f;">The diary-chinese-anniversary function in cal-china only supports 
</span><span style="color: #7a5f2f;">;; </span><span style="color: #7a5f2f;">the American date format, so we need to use '</span><span style="color: #065fff;">let</span><span style="color: #7a5f2f;">' to locally define the variable.
</span><span style="color: #007a85;">(</span><span style="color: #004fc0;">defun</span> <span style="color: #00845f;">my/diary-chinese-anniversary</span> <span style="color: #004fc0;">(</span>year month day<span style="color: #004fc0;">)</span>
  <span style="color: #004fc0;">(</span><span style="color: #004fc0;">let</span> <span style="color: #00845f;">(</span><span style="color: #7f5ae0;">(</span>calendar-date-style 'american<span style="color: #7f5ae0;">)</span><span style="color: #00845f;">)</span>
    <span style="color: #00845f;">(</span>diary-chinese-anniversary month day year nil<span style="color: #00845f;">)</span><span style="color: #004fc0;">)</span><span style="color: #007a85;">)</span>

<span style="color: #7a5f2f;">;; </span><span style="color: #7a5f2f;">Calculate the Chinese lunar year structure for a given Gregorian date
</span><span style="color: #007a85;">(</span><span style="color: #004fc0;">defun</span> <span style="color: #00845f;">my/chinese-year</span> <span style="color: #004fc0;">(</span>year month day<span style="color: #004fc0;">)</span>
    <span style="color: #004fc0;">(</span>+ <span style="color: #00845f;">(</span>* 100 <span style="color: #7f5ae0;">(</span>car <span style="color: #1f6fbf;">(</span>calendar-chinese-from-absolute <span style="color: #4244ef;">(</span>calendar-absolute-from-gregorian <span style="color: #468400;">(</span>diary-make-date year month day<span style="color: #468400;">)</span><span style="color: #4244ef;">)</span><span style="color: #1f6fbf;">)</span><span style="color: #7f5ae0;">)</span><span style="color: #00845f;">)</span>
       <span style="color: #00845f;">(</span>cadr <span style="color: #7f5ae0;">(</span>calendar-chinese-from-absolute <span style="color: #1f6fbf;">(</span>calendar-absolute-from-gregorian <span style="color: #4244ef;">(</span>diary-make-date year month day<span style="color: #4244ef;">)</span><span style="color: #1f6fbf;">)</span><span style="color: #7f5ae0;">)</span><span style="color: #00845f;">)</span><span style="color: #004fc0;">)</span><span style="color: #007a85;">)</span>
</code></pre>
</div>

<p>
With this setup, you can use the following code to display the lunar birthday reminder for the 10th day of the 8th lunar month, 1949 (Gregorian: October 1, 1949).<br>
</p>

<div class="org-src-container">
<pre class="src src-elisp"><code>%%<span style="color: #007a85;">(</span>my/diary-chinese-anniversary <span style="color: #004fc0;">(</span>my/chinese-year 1949 10 1<span style="color: #004fc0;">)</span> 8 10<span style="color: #007a85;">)</span> The %dth Lunar birthday of New China
</code></pre>
</div>
</div>
<div id="postamble" class="status">
<p>© Published by <a href="https://www.gnu.org/software/emacs/">Emacs</a> 31.0.50 (<a href="https://orgmode.org">Org</a> mode 9.8-pre)　|　<a href="https://tomoemami.github.io/rss.xml">RSS</a>　<a href="https://tomoemami.github.io/20251121T151653--english-post-index__wiki.html">English-Index</a></p>
</div>
</body>
</html>
