<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2026-01-06 周二 17:28 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>emacs-变相在windows上使用emacs-client</title>
<meta name="generator" content="Org Mode" />
<link rel='stylesheet' type='text/css' href='/org.css'/>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href=""> UP </a>
 |
 <a accesskey="H" href="index.html"> HOME </a>
</div><div id="preamble" class="status">
<p>▼ 本文更新于 <span class="timestamp-wrapper"><span class="timestamp">[2026-01-06 周二 17:18]</span></span></p>
</div>
<div id="content" class="content">
<header>
<h1 class="title">emacs-变相在windows上使用emacs-client</h1>
</header><p>
<span class="timestamp-wrapper"><time class="timestamp" datetime="2024-07-13T15:29:00">[2024-07-13 周六 15:29]</time></span><br>
</p>

<p>
在配置中设置默认启动server：<br>
</p>

<div class="org-src-container">
<pre class="src src-elisp"><code>
<span style="color: #a7601f;">(</span><span style="color: #006f00;">defun</span> <span style="color: #a7601f;">my/set-gui</span> <span style="color: #557400;">()</span>
  <span style="color: #557400;">(</span>set-font <span style="color: #ca3400;">"Cascadia Code"</span> <span style="color: #ca3400;">"HarmonyOS Sans SC"</span> 32 32<span style="color: #557400;">)</span>
  <span style="color: #557400;">(</span>set-frame-position <span style="color: #bf4400;">(</span>selected-frame<span style="color: #bf4400;">)</span> 100 100<span style="color: #557400;">)</span>
  <span style="color: #8f6f4a;">;;</span><span style="color: #8f6f4a;">&#35774;&#32622;&#23485;&#21644;&#39640;,&#25105;&#30340;&#21313;&#23544;&#23567;&#26412;&#26159;110,33,&#22823;&#23478;&#21487;&#20197;&#35843;&#25972;&#36825;&#20010;&#21442;&#25968;&#26469;&#36866;&#24212;&#33258;&#24049;&#23631;&#24149;&#22823;&#23567;
</span>  <span style="color: #557400;">(</span>set-frame-width <span style="color: #bf4400;">(</span>selected-frame<span style="color: #bf4400;">)</span> 170<span style="color: #557400;">)</span>
  <span style="color: #557400;">(</span>set-frame-height <span style="color: #bf4400;">(</span>selected-frame<span style="color: #bf4400;">)</span> 30<span style="color: #557400;">)</span>
<span style="color: #a7601f;">)</span>
<span style="color: #a7601f;">(</span><span style="color: #006f00;">setq</span> server-auth-dir <span style="color: #ca3400;">"~/emacs-local"</span><span style="color: #a7601f;">)</span>
<span style="color: #a7601f;">(</span><span style="color: #006f00;">if</span> <span style="color: #557400;">(</span>not <span style="color: #bf4400;">(</span>server-running-p<span style="color: #bf4400;">)</span><span style="color: #557400;">)</span>
    <span style="color: #557400;">(</span><span style="color: #006f00;">progn</span> <span style="color: #bf4400;">(</span>server-start<span style="color: #bf4400;">)</span>
           <span style="color: #bf4400;">(</span>add-hook 'server-after-make-frame-hook #'my/set-gui<span style="color: #bf4400;">)</span>
           <span style="color: #557400;">)</span><span style="color: #a7601f;">)</span>
</code></pre>
</div>

<p>
然后将启动Emacs的快捷方式路径改为<br>
</p>
<div class="org-src-container">
<pre class="src src-nil"><code>D:\Emacs\bin\emacsclientw.exe  -c -n -f %APPDATA%\emacs-local\server -e "(raise-frame)" -a "D:\Emacs\bin\runemacs.exe"
</code></pre>
</div>

<p>
再将 <code>C-x C-c</code> 绑定到 <code>make-frame-invisible</code> 函数上：<br>
</p>

<div class="org-src-container">
<pre class="src src-elisp"><code><span style="color: #a7601f;">(</span>global-set-key <span style="color: #557400;">(</span>kbd <span style="color: #ca3400;">"C-x C-c"</span><span style="color: #557400;">)</span> <span style="color: #557400;">(</span><span style="color: #006f00;">lambda</span> <span style="color: #bf4400;">()</span> <span style="color: #bf4400;">(</span><span style="color: #006f00;">interactive</span><span style="color: #bf4400;">)</span> <span style="color: #bf4400;">(</span>make-frame-invisible nil t<span style="color: #bf4400;">)</span><span style="color: #557400;">)</span><span style="color: #a7601f;">)</span>
</code></pre>
</div>

<p>
这样一来，按组合键时就会让当前窗口消失，再次点击上述快捷方式又能呼出，且窗口内容保持不变；点击窗口右上角为彻底关闭当前Emacs程序。<br>
</p>

<p>
在实现Daemon、Client的功能同时，避免了直接使用Emacs-Server导致的GUI、配置加载等问题。<br>
</p>

<p>
<span class="timestamp-wrapper"><time class="timestamp" datetime="2024-07-25T09:02:00">[2024-07-25 周四 09:02]</time></span>：利用 <code>%APPDATA%</code> 这个系统变量自动化为每台电脑创建一个不同的Server文件。<br>
</p>

<p>
注意此时若使用<a href="https://github.com/sprig/org-capture-extension">org-captude的chrome插件</a> ，需要将reg文件用bat批量生成（以便自动化嵌入系统名称）。<br>
</p>

<p>
创建emacs-org-protocol.bat文件，内容如下：<br>
</p>
<div class="org-src-container">
<pre class="src src-bat"><code>@<span style="color: #557400;">echo</span> off
<span style="color: #557400;">echo</span> REGEDIT4 &gt;t1.reg
<span style="color: #557400;">echo</span> <span style="color: #a7601f;">[</span>HKEY_CLASSES_ROOT\org-protocol<span style="color: #a7601f;">]</span> &gt;&gt;e1.reg
<span style="color: #557400;">echo</span> @=<span style="color: #ca3400;">"URL:Org Protocol"</span> &gt;&gt;e1.reg
<span style="color: #557400;">echo</span> <span style="color: #ca3400;">"URL Protocol"</span>=<span style="color: #ca3400;">""</span> &gt;&gt;e1.reg
<span style="color: #557400;">echo</span> <span style="color: #a7601f;">[</span>HKEY_CLASSES_ROOT\org-protocol\shell<span style="color: #a7601f;">]</span> &gt;&gt;e1.reg
<span style="color: #557400;">echo</span> <span style="color: #a7601f;">[</span>HKEY_CLASSES_ROOT\org-protocol\shell\open<span style="color: #a7601f;">]</span> &gt;&gt;e1.reg
<span style="color: #557400;">echo</span> <span style="color: #a7601f;">[</span>HKEY_CLASSES_ROOT\org-protocol\shell\open\command<span style="color: #a7601f;">]</span> &gt;&gt;e1.reg
<span style="color: #557400;">echo</span> @=<span style="color: #ca3400;">"\"</span>D:\\Emacs\\bin\\emacsclientw.exe\<span style="color: #ca3400;">"  -</span><span style="color: #ca3400;">f</span><span style="color: #ca3400;"> %APPDATA%\emacs-local\server \"</span>%%<span style="color: #007a9f;">1</span>\<span style="color: #ca3400;">""</span> &gt;&gt;e1.reg
</code></pre>
</div>

<p>
然后新电脑运行该文件，再运行生成后的e1.reg就完成了协议注册。<br>
</p>
<div id="outline-container-org896cd90" class="outline-2">
<h2 id="org896cd90"><span class="section-number-2">1.</span> 新版方式</h2>
<div class="outline-text-2" id="text-1">
<p>
<span class="timestamp-wrapper"><time class="timestamp" datetime="2024-11-06T17:21:00">[2024-11-06 周三 17:21]</time></span> 采取以下方式，在启动时就隐藏Emacs主窗口：<br>
</p>

<div class="org-src-container">
<pre class="src src-elisp"><code><span style="color: #8f6f4a;">;; </span><span style="color: #8f6f4a;">&#36825;&#37324;&#38754;&#21482;&#35774;&#32622;&#23383;&#20307;
</span><span style="color: #a7601f;">(</span><span style="color: #006f00;">defun</span> <span style="color: #a7601f;">my/set-gui</span> <span style="color: #557400;">()</span>
  <span style="color: #557400;">(</span><span style="color: #006f00;">if</span> <span style="color: #bf4400;">(</span>eq system-type 'darwin<span style="color: #bf4400;">)</span>
      <span style="color: #bf4400;">(</span><span style="color: #006f00;">progn</span>
        <span style="color: #8f6f4a;">;; </span><span style="color: #8f6f4a;">(set-font "Cascadia Code" "HarmonyOS Sans SC" 18 18)
</span>        <span style="color: #3f6faf;">(</span>set-font <span style="color: #ca3400;">"Cascadia Code NF"</span> <span style="color: #ca3400;">"FangSongCode"</span> 20 20<span style="color: #3f6faf;">)</span>
        <span style="color: #3f6faf;">(</span>toggle-frame-maximized<span style="color: #3f6faf;">)</span>
        <span style="color: #8f6f4a;">;; </span><span style="color: #8f6f4a;">(add-to-list 'default-frame-alist '(undecorated . t))
</span>        <span style="color: #3f6faf;">(</span>sis-set-english<span style="color: #3f6faf;">)</span><span style="color: #bf4400;">)</span>
    <span style="color: #bf4400;">(</span><span style="color: #006f00;">progn</span>
      <span style="color: #3f6faf;">(</span><span style="color: #006f00;">cond</span> <span style="color: #00824f;">(</span><span style="color: #9a456f;">(</span>string= <span style="color: #a2604f;">(</span>system-name<span style="color: #a2604f;">)</span> <span style="color: #ca3400;">"DZB-114514"</span><span style="color: #9a456f;">)</span><span style="color: #8f6f4a;">;;</span><span style="color: #8f6f4a;">OFFICE
</span>             <span style="color: #9a456f;">(</span>set-font <span style="color: #ca3400;">"Cascadia Code NF SemiLight"</span> <span style="color: #ca3400;">"FangSongCode"</span> 40 40<span style="color: #9a456f;">)</span><span style="color: #00824f;">)</span>
            <span style="color: #00824f;">(</span><span style="color: #9a456f;">(</span>string= <span style="color: #a2604f;">(</span>system-name<span style="color: #a2604f;">)</span> <span style="color: #ca3400;">"DESKTOP-FR36SPM"</span><span style="color: #9a456f;">)</span><span style="color: #8f6f4a;">;;</span><span style="color: #8f6f4a;">H
</span>             <span style="color: #9a456f;">(</span>set-font <span style="color: #ca3400;">"Cascadia Code NF SemiLight"</span> <span style="color: #ca3400;">"FangSongCode"</span> 40 40<span style="color: #9a456f;">)</span><span style="color: #00824f;">)</span><span style="color: #3f6faf;">)</span>
      <span style="color: #3f6faf;">(</span><span style="color: #006f00;">let*</span> <span style="color: #00824f;">(</span><span style="color: #9a456f;">(</span>display-width <span style="color: #a2604f;">(</span>display-pixel-width<span style="color: #a2604f;">)</span><span style="color: #9a456f;">)</span>
             <span style="color: #9a456f;">(</span>display-height <span style="color: #a2604f;">(</span>display-pixel-height<span style="color: #a2604f;">)</span><span style="color: #9a456f;">)</span>
             <span style="color: #9a456f;">(</span>frame-width <span style="color: #a2604f;">(</span>floor <span style="color: #007a9f;">(</span>* 0.9 display-width<span style="color: #007a9f;">)</span><span style="color: #a2604f;">)</span><span style="color: #9a456f;">)</span>
             <span style="color: #9a456f;">(</span>frame-height <span style="color: #a2604f;">(</span>floor <span style="color: #007a9f;">(</span>* 0.8 display-height<span style="color: #007a9f;">)</span><span style="color: #a2604f;">)</span><span style="color: #9a456f;">)</span>
             <span style="color: #9a456f;">(</span>left-offset <span style="color: #a2604f;">(</span>floor <span style="color: #007a9f;">(</span>* 0.05 display-width<span style="color: #007a9f;">)</span><span style="color: #a2604f;">)</span><span style="color: #9a456f;">)</span>
             <span style="color: #9a456f;">(</span>top-offset <span style="color: #a2604f;">(</span>floor <span style="color: #007a9f;">(</span>* 0.05 display-height<span style="color: #007a9f;">)</span><span style="color: #a2604f;">)</span><span style="color: #9a456f;">)</span><span style="color: #00824f;">)</span>
        <span style="color: #00824f;">(</span>set-frame-position <span style="color: #9a456f;">(</span>selected-frame<span style="color: #9a456f;">)</span> left-offset top-offset<span style="color: #00824f;">)</span>
        <span style="color: #00824f;">(</span>set-frame-size <span style="color: #9a456f;">(</span>selected-frame<span style="color: #9a456f;">)</span> frame-width frame-height t<span style="color: #00824f;">)</span><span style="color: #3f6faf;">)</span>
      <span style="color: #3f6faf;">(</span>sis-set-english<span style="color: #3f6faf;">)</span><span style="color: #bf4400;">)</span>
    <span style="color: #557400;">)</span><span style="color: #a7601f;">)</span>
<span style="color: #a7601f;">(</span>add-hook 'server-after-make-frame-hook #'my/set-gui<span style="color: #a7601f;">)</span>
<span style="color: #8f6f4a;">;; </span><span style="color: #8f6f4a;">&#24378;&#21046;&#21024;&#38500;&#26087;server&#25991;&#20214;&#36991;&#20813;&#21344;&#29992;
</span><span style="color: #a7601f;">(</span>server-force-delete<span style="color: #a7601f;">)</span>
<span style="color: #8f6f4a;">;; </span><span style="color: #8f6f4a;">&#30452;&#25509;&#21551;&#21160;&#26381;&#21153;&#22120;&#65292;&#26080;&#35270;&#35686;&#21578;
</span><span style="color: #a7601f;">(</span><span style="color: #006f00;">ignore-errors</span> <span style="color: #557400;">(</span>server-start<span style="color: #557400;">)</span><span style="color: #a7601f;">)</span>
<span style="color: #8f6f4a;">;; </span><span style="color: #8f6f4a;">&#24403;&#21069;&#31383;&#21475;&#38544;&#34255;
</span><span style="color: #a7601f;">(</span>make-frame-invisible nil t<span style="color: #a7601f;">)</span>
</code></pre>
</div>

<p>
然后参考<a href="https://support.microsoft.com/zh-cn/windows/%E5%9C%A8-windows-%E4%B8%AD%E9%85%8D%E7%BD%AE%E5%90%AF%E5%8A%A8%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F-115a420a-0bff-4a6f-90e0-1934c844e473">这个指南</a>配置自启动​<code>runemacs.exe</code>​。这样一来，开机之后Emacs就会完全载入配置且作为daemon模式存在，通过上面的快捷方式路径或listary等软件即可快速呼出新client窗口。<br>
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p>© Published by <a href="https://www.gnu.org/software/emacs/">Emacs</a> 31.0.50 (<a href="https://orgmode.org">Org</a> mode 9.8-pre)　|　<a href="https://tomoemami.github.io/rss.xml">RSS</a>　<a href="https://tomoemami.github.io/20251121T151653--english-post-index__wiki.html">English-Index</a></p>
</div>
</body>
</html>
