<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2025-10-19 周日 16:07 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>emacs-使用cron风格设置任务重复</title>
<meta name="generator" content="Org Mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
/*@import url("https://fonts.googleapis.com/css2?family=Lora:wght@500&display=fallback");
@import url("https://fonts.googleapis.com/css2?family=Inconsolata&display=fallback");
*/

body {
    margin: 2% auto;
    width: 100%;
    max-width: 100%;
    background-color: rgba(242,229,188,0.5);
    /* background-color: rgba(255,255,255,0.5); */
    font-size: 18px;
    line-height: 1.4em;
}
@media screen and (min-width: 600px) {
    body {
        font-size: 18px;
    }
}

@media screen and (min-width: 910px) {
    body {
        width: 900px;
    }
}
#preamble {
    width: 80%;
    max-width: 980px;
    text-align: left;
    margin: auto;
    font-size: 80%;
}

hr {
    border: none;
    border-top: 5px double #333;
    margin: 0px 0;
}

.button {
    border: none;
    color: black;
    padding: 6px 14px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    margin: 4px 2px;
    transition-duration: 0.4s;
    cursor: pointer;
}

.button:hover {
    background-color: #3a1616;
    color: white;
}

.todo {
    background-color: #9d0006;
    color: #fbf1c7;
    padding: .1em 0.3em;
    border-radius: 3px;
    background-clip: padding-box;
    font-size: $code-size;
    font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;
    line-height: 1;
}

.done {
    background-color: #427b58;
    color: #fbf1c7;
    padding: .1em 0.3em;
    border-radius: 3px;
    background-clip: padding-box;
    font-size: $code-size;
    font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;
    line-height: 1;
}

#postamble p {
    font-size: 80%;
    margin: .2em;
    text-align: center;
}

#content, .content {
    width: 80%;
    max-width: 980px;
    margin: auto;
}

#org-div-home-and-up{
    position: fixed;
    right: 0.5em;
    margin-top: 70px;
    font-family:sans-serif;
}

#table-of-contents {
    margin-top: 105px;
    font-size: 12pt;
    position: fixed;
    left: 0em;
    top: 0em;
    background: white;
    max-height: 80%;
    overflow: auto;
}

#table-of-contents h2 {
    display: none;
}
#table-of-contents li {
    clear: both;
}
.timestamp {
    color: #928374;
    font-size: $smaller;
}

.timestamp-kwd {
    color: #5f9ea0;
}

@media screen and (max-width: 1200px) {
    #table-of-contents {
        position: relative;
        margin-top: 0px;
    }
}

/* p:not(blockquote > p) :not(ol > p) { */
/*     text-indent: 2em; */
/* } */
p {
    margin: 1em auto;
}

.title {
    font-size: 30px;
    line-height: 1.3;
    font-weight: bold;
    color: #0c2340;
}

h2:not(#table-of-contents > h2) {
    font-size: 30px;
    line-height: 1.2;
    position: relative;
    color: #204060;
}

h2::after {
    content: "";
    position: absolute;
    left: 0;
    bottom: 0;
    width: 100%;
    height: 2px;
    background-color: black;
}

h3:not(#table-of-contents > h3) {
    font-size: 20px;
    line-height: 1.1;
    position: relative;
    color: #4b748d;
}

h3::after {
    content: "";
    position: absolute;
    left: 0;
    bottom: 0;
    width: 100%;
    height: 2px;
    /* border-bottom: 1px dashed black; */
}

h4 {
    font-size: 14px;
    line-height: 1.1;
    font-weight: bold;
}


a {
    cursor: pointer;
    text-decoration: none;
}

a:link {
    color: #458588;
    /* text-decoration: underline; */
}

a:hover {
    /* font-weight: bold; */
    text-decoration: underline;
    /* color: #076678; */
}

.figure {
    text-align: center;
}

a:visited{
    color: #8f3f71;
    /* text-decoration: underline; */
}

img {
    max-width: 100%;
    vertical-align: middle;
}
.MathJax_Display {
    margin: 0!important;
    width: $smaller!important;
}
@media screen and (max-width: 1200px) {
    img {
        width: 400px;
    }
    .MathJax_Display {
        margin: 0!important;
        width: $smaller!important;
    }
}

.org-src-container {
    font-size: 14px;
    outline: 2px dashed #ccc;
    outline-offset: 10px;
    position: relative;

}
.org-src-container>pre {
    overflow: auto;
    font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Cascadia Code,Consolas, Liberation Mono, monospace;
}

.org-src-container>pre:before {
    display: block;
    position: absolute;
    background-color: #b3b3b3;
    top: 0;
    right: 0;
    padding: 0 0.5em;
    border-bottom-left-radius: 8px;
    border: 0;
    color: white;
    font-size: $code-size;

}
pre {
    overflow: auto;

}
.example{
    font-size: 14px;
    outline: 2px dashed #ccc;
    outline-offset: 10px;
    position: relative;
    
}
.example::before {
    content: "Results";
}
pre:before {
    display: block;
    position: absolute;
    background-color: #b3b3b3;
    top: 0;
    right: 0;
    padding: 0 0.5em;
    border-bottom-left-radius: 8px;
    border: 0;
    color: white;
    font-size: $code-size;
}
/* .org-src-container::before { */
/*     content: "Copy"; */
/*     position: absolute; */
/*     top: 5px; */
/*     right: 5px; */
/*     padding: 5px; */
/*     background-color: #ccc; */
/*     color: #fff; */
/*     border-radius: 3px; */
/*     cursor: pointer; */
/* } */

code {
    font-size: 16px;
    color: #427b58;
    font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Cascadia Code,Consolas, Liberation Mono, monospace;
}

.subtitle {
    text-align: right;
}

blockquote {
    border-left: 3px solid #ccc;
    padding-left: 10px; /* Optional: add some left padding for the content */
    margin-inline-start: 0px;
    margin-inline-end: 0px;
}

.info {
    overflow: hidden;
}

.created {
    float: right;
}

.updated {
    float: left;
}

.org-ol {
    list-style-type: decimal; /* Set the list style type to decimal numbers */
    /* margin-left: 0.5em; /\* Add left margin to the list *\/ */
}

b {
    color: #9d0006;
}

#footnotes {
    position: fixed;
    left: auto;
    right: 0;
    top: 105px;
    bottom: 0;
    width: 20%;
    padding: 10px;
    overflow: auto;
    font-size: 14px;
    z-index: 9999;
}

#footnotes h2 {
    display: none;
}

@media screen and (max-width: 1200px) {
    #footnotes {
        position: static;
        left: 0;
        right: 0;
        bottom: 0;
        width: 100%;
        max-height: 30%;
        overflow: auto;
        padding: 10px;
        font-size: 14px;
        z-index: 9999;
    }
}
/*]]>*/-->
 </style>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href=""> UP </a>
 |
 <a accesskey="H" href="index.html"> HOME </a>
</div><div id="preamble" class="status">
<p>▼ 本文更新于 <span class="timestamp-wrapper"><span class="timestamp">[2025-09-09 周二 20:15]</span></span></p>
</div>
<div id="content" class="content">
<h1 class="title">emacs-使用cron风格设置任务重复</h1>
<div id="outline-container-orgbfd4259" class="outline-2">
<h2 id="orgbfd4259"><span class="section-number-2">1.</span> 前言</h2>
<div class="outline-text-2" id="text-1">
<p>
org-mode的任务管理功能一直为人所称道，特别是 <code>SCHEDULED</code> 、 <code>DEADLINE</code> 和 <code>TIMESTAMP/SEXP</code> 之间的微妙差异。一般来说，只要使用基础的 <code>reapter</code> ，如 <code>.+</code> 和 <code>++</code> ，便足以应付绝大部分待办事项重复，更复杂日程则可以通过 <code>%</code> 开头的sexp来表示。但是在一些特定的场景，这一套系统便有了不便。<br />
</p>

<p>
比如，你每周一会看一部<a href="https://bgm.tv/subject/528438">动画片A</a>，所以给动画片A的heading设置了一个重复任务。<br />
</p>

<div class="org-src-container">
<pre class="src src-org"><code><span style="color: #8f2f30;">* </span><span style="color: #b20f00;">TODO</span><span style="color: #8f2f30;"> &#26126;&#22825;&#65292;&#32654;&#39135;&#24191;&#22330;&#35265;&#12290;</span>
<span style="color: #6e678f;">SCHEDULED:</span><span style="color: #3f712f;">&lt;2025-08-11 Mon ++1w&gt;</span>
</code></pre>
</div>

<p>
那么，如果你在8月11日没有将这个任务标为 <code>DONE</code> ，则会在你的 <code>Agenda</code> 中持续显示一个过期的待办项 <code>TODO 明天，美食广场见。</code> 。或许对于一些洁癖或细节控来说，一直挂着一个过期任务会让人发狂，但倘若你并不是这种人，可能也无所谓了。<br />
</p>

<p>
真是这样吗？不妨设想如下的场景：你决定在本周末看这个动画，于是将其重新设置到了周六。<br />
</p>

<div class="org-src-container">
<pre class="src src-org"><code><span style="color: #8f2f30;">* </span><span style="color: #b20f00;">TODO</span><span style="color: #8f2f30;"> &#26126;&#22825;&#65292;&#32654;&#39135;&#24191;&#22330;&#35265;&#12290;</span>
<span style="color: #6e678f;">SCHEDULED:</span><span style="color: #3f712f;">&lt;2025-08-16 Sat ++1w&gt;</span>
</code></pre>
</div>

<p>
那么，如果你在周末看完了最新的一集（虽然在现实中该动画只有六集，并不会再有最新的一集了），并将其标记为 <code>DONE</code> ，则会发生如下事情：<br />
</p>

<div class="org-src-container">
<pre class="src src-org"><code><span style="color: #8f2f30;">* </span><span style="color: #b20f00;">TODO</span><span style="color: #8f2f30;"> &#26126;&#22825;&#65292;&#32654;&#39135;&#24191;&#22330;&#35265;&#12290;</span>
<span style="color: #6e678f;">SCHEDULED:</span><span style="color: #3f712f;">&lt;2025-08-23 Sat ++1w&gt;</span>
</code></pre>
</div>

<p>
下一次提醒的时间，会从周一转换到了周六。<br />
</p>

<p>
简而言之，就是如果你频繁依赖 <code>SCHEDULED</code> 来进行日程安排（如 <code>org-agenda/Org-ql-block</code> ），或者接收任务提醒（如 <code>appt/orgzly/beorg</code> ），那么就会遇到一些固定重复的任务，会因重新设定计划日期，导致下次重复日期变动。<br />
</p>

<p>
这时候，就轮到<a href="https://github.com/Raemi/org-reschedule-by-rule">org-reschedule-by-rule</a>包登场了。<br />
</p>

<p>
<span class="timestamp-wrapper"><span class="timestamp">[2025-09-09 周二 20:08]</span></span> ： 我修改了该包，移除了python依赖并进行了一些小改动，重新发布在<a href="https://github.com/TomoeMami/org-repeat-by-cron.el">org-repeat-by-cron</a>这里。不需要下文的安装依赖即可使用。<br />
</p>
</div>
</div>
<div id="outline-container-org6c9ce16" class="outline-2">
<h2 id="org6c9ce16"><span class="section-number-2">2.</span> 依赖安装</h2>
<div class="outline-text-2" id="text-2">
<p>
该包依赖Python的 <code>croniter</code> 包，需要安装。<br />
</p>

<p>
Windows上：直接打开终端，输入 <code>pip install croniter</code> 即可。<br />
</p>

<p>
MacOS或Linux上： 在终端中输入 <code>pip3 install croniter --break-system-packages</code> 即可。<br />
</p>
</div>
</div>
<div id="outline-container-org23ff558" class="outline-2">
<h2 id="org23ff558"><span class="section-number-2">3.</span> 使用</h2>
<div class="outline-text-2" id="text-3">
<p>
将GitHub上的 <code>org-reschedule-by-rule.el</code> 放到 <code>路径A</code> 中，然后配置 <code>use-package</code> 即可。<br />
</p>

<div class="org-src-container">
<pre class="src src-elisp"><code><span style="color: #007000;">(</span><span style="color: #8f2f30; font-weight: bold;">use-package</span> org-reschedule-by-rule
  <span style="color: #00704f; font-weight: bold;">:demand</span> t
  <span style="color: #00704f; font-weight: bold;">:load-path</span> <span style="color: #557000;">"&#36335;&#24452;A"</span><span style="color: #007000;">)</span>
</code></pre>
</div>

<p>
以先前的例子为例，设置任务的 <code>RESCHEDULE_CRON</code> 属性即可。<br />
</p>
<div class="org-src-container">
<pre class="src src-org"><code><span style="color: #8f2f30;">* </span><span style="color: #b20f00;">TODO</span><span style="color: #8f2f30;"> &#26126;&#22825;&#65292;&#32654;&#39135;&#24191;&#22330;&#35265;&#12290;</span>
<span style="color: #6e678f;">SCHEDULED:</span><span style="color: #3f712f;">&lt;2025-08-23 Sat&gt;</span>
<span style="color: #6e678f;">:PROPERTIES:</span>
<span style="color: #6e678f;">:RESCHEDULE_CRON:</span> <span style="color: #8a5f4a;">* * Mon</span>
<span style="color: #6e678f;">:END:</span>
</code></pre>
</div>

<p>
<code>SCHEDULED</code> 中不应使用repeater，可能造成重复日期的错误。<br />
</p>

<p>
<code>RESCHEDULE_CRON</code> 中可以使用三字段或五字段，具体的含义如下：<br />
</p>

<div class="org-src-container">
<pre class="src src-bash"><code>  * * * * * 
<span style="color: #6e678f; font-style: italic;"># </span><span style="color: #6e678f; font-style: italic;">| | | | |
</span><span style="color: #6e678f; font-style: italic;"># </span><span style="color: #6e678f; font-style: italic;">| | | | &#21608;&#20960; (0&#8211;6) (&#25110;&#32773;&#33521;&#25991;&#31616;&#20889; Sun Mon Tue Wed Thu Fri Sat)
</span><span style="color: #6e678f; font-style: italic;"># </span><span style="color: #6e678f; font-style: italic;">| | | &#26376;&#20221; (1&#8211;12)            
</span><span style="color: #6e678f; font-style: italic;"># </span><span style="color: #6e678f; font-style: italic;">| | &#26085;&#26399; (1&#8211;31)
</span><span style="color: #6e678f; font-style: italic;"># </span><span style="color: #6e678f; font-style: italic;">| &#23567;&#26102; (0&#8211;23)
</span><span style="color: #6e678f; font-style: italic;"># </span><span style="color: #6e678f; font-style: italic;">&#20998;&#38047; (0&#8211;59)</span>
</code></pre>
</div>

<p>
当我们使用三字段时，则会将前面的小时与分钟默认填为0。即： <code>* * Fri</code> 等价于 <code>0 0 * * Fri</code> 。<br />
</p>

<p>
这样一来，标记上述任务完成后，会自动将其计划到原 <code>SCHEDULED</code> 日期（这里是8月23日）的下一个周一（8月25日），并增加 <code>RESCHEDULE_ANCHOR</code> 时间为8月25日。<br />
</p>

<div class="org-src-container">
<pre class="src src-org"><code><span style="color: #8f2f30;">* </span><span style="color: #b20f00;">TODO</span><span style="color: #8f2f30;"> &#26126;&#22825;&#65292;&#32654;&#39135;&#24191;&#22330;&#35265;&#12290;</span>
<span style="color: #6e678f;">SCHEDULED:</span> <span style="color: #3f712f;">&lt;2025-08-25 &#21608;&#19968;&gt;</span>
<span style="color: #6e678f;">:PROPERTIES:</span>
<span style="color: #6e678f;">:RESCHEDULE_CRON:</span> <span style="color: #8a5f4a;">* * Mon</span>
<span style="color: #6e678f;">:RESCHEDULE_ANCHOR:</span> <span style="color: #8a5f4a;">2025-08-25 &#21608;&#19968;</span>
<span style="color: #6e678f;">:END:</span>
</code></pre>
</div>

<p>
此时，不管我们怎么更改 <code>SCHEDULED</code> 的日期，标为完成后总会计划到从 <code>RESCHEDULE_ANCHOR</code> 往后的、符合 <code>RESCHEDULE_CRON</code> 规则的日期。<br />
</p>

<p>
当然，我们也可以手动设置 <code>RESCHEDULE_INTERVAL</code> ，明确重复的间隔。<br />
</p>
</div>
</div>
<div id="outline-container-org8c0726c" class="outline-2">
<h2 id="org8c0726c"><span class="section-number-2">4.</span> 流程解析</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-orga80a0a7" class="outline-3">
<h3 id="orga80a0a7"><span class="section-number-3">4.1.</span> 监听</h3>
<div class="outline-text-3" id="text-4-1">
<p>
监听 Org 任务状态变化，当任务被标记为 <code>DONE</code> 时触发。<br />
</p>
</div>
</div>
<div id="outline-container-org85feb27" class="outline-3">
<h3 id="org85feb27"><span class="section-number-3">4.2.</span> 读取规则</h3>
<div class="outline-text-3" id="text-4-2">
<p>
检查当前任务是否定义了 <code>RESCHEDULE_INTERVAL</code> 或 <code>RESCHEDULE_CRON</code> 属性，无则跳过<br />
</p>
</div>
</div>
<div id="outline-container-orgd0592f3" class="outline-3">
<h3 id="orgd0592f3"><span class="section-number-3">4.3.</span> 计算下一个调度日期</h3>
<div class="outline-text-3" id="text-4-3">
<p>
首先需要确定计算的起点（基准时间）。会优先使用 <code>RESCHEDULE_ANCHOR</code> 的值。如果不存在，则退而求其次使用任务当前的 <code>SCHEDULED</code> 时间戳，如果连这个也没有，就使用当前时间。<br />
</p>

<p>
然后会调用Python的 <code>croniter</code> 库计算下一个调度日期：<br />
</p>

<p>
如果定义了 <code>RESCHEDULE_INTERVAL</code> ，则会在基准时间上增加相应的时间间隔，得到一个候选日期。当 <code>RESCHEDULE_CRON</code> 表达式为空，或上述候选日期满足表达式的约束，则会输出一个有效的未来日期。<br />
</p>

<p>
如果没有定义 <code>RESCHEDULE_INTERVAL</code> ，则会检查是否有 <code>RESCHEDULE_CRON</code> 表达式。如果没有，则报错；如果有，则会输出满足表达式的、最近的未来时间。<br />
</p>

<p>
代码逻辑：<br />
</p>
<div class="org-src-container">
<pre class="src src-python"><code><span style="color: #8f2f30; font-weight: bold;">if</span> interval:
    <span style="color: #aa184f;">&#20559;&#31227;</span> <span style="color: #393330;">=</span> &#35745;&#31639;&#20559;&#31227;<span style="color: #007000;">(</span>interval<span style="color: #007000;">)</span> <span style="color: #6e678f; font-style: italic;">#</span><span style="color: #6e678f; font-style: italic;">&#21487;&#36873;&#21333;&#20301;&#20026; h d w m y &#23567;&#26102; &#22825; &#21608; &#26376; &#24180;
</span>    <span style="color: #aa184f;">&#20505;&#36873;&#26102;&#38388;</span> <span style="color: #393330;">=</span> &#22522;&#20934;&#26102;&#38388; <span style="color: #393330;">+</span> &#20559;&#31227;
    <span style="color: #aa184f;">&#35745;&#25968;</span> <span style="color: #393330;">=</span> 0
    <span style="color: #8f2f30; font-weight: bold;">while</span> <span style="color: #a23ea4;">True</span>:
    <span style="color: #db74ade6a207;"> </span>   <span style="color: #aa184f;">&#35745;&#25968;</span> <span style="color: #393330;">+=</span> 1
    <span style="color: #db74ade6a207;"> </span>   <span style="color: #8f2f30; font-weight: bold;">if</span> &#35745;&#25968; <span style="color: #393330;">&gt;</span> &#26368;&#22823;&#23581;&#35797;&#27425;&#25968;:
    <span style="color: #db74ade6a207;"> </span>   <span style="color: #db74ade6a207;"> </span>   sys.<span style="color: #a23ea4;">exit</span><span style="color: #007000;">(</span>1<span style="color: #007000;">)</span> <span style="color: #6e678f; font-style: italic;">#</span><span style="color: #6e678f; font-style: italic;">&#25253;&#38169;
</span>    <span style="color: #db74ade6a207;"> </span>   <span style="color: #8f2f30; font-weight: bold;">if</span> &#20505;&#36873;&#26102;&#38388; <span style="color: #393330;">&gt;</span> &#24403;&#21069;&#26102;&#38388; <span style="color: #8f2f30; font-weight: bold;">and</span> <span style="color: #007000;">(</span>cron&#34920;&#36798;&#24335; <span style="color: #8f2f30; font-weight: bold;">is</span> <span style="color: #a23ea4;">None</span> <span style="color: #8f2f30; font-weight: bold;">or</span> croniter.<span style="color: #8f2f30; font-weight: bold;">match</span><span style="color: #8f2f30;">(</span>cron&#34920;&#36798;&#24335;, &#20505;&#36873;&#26102;&#38388; <span style="color: #8f2f30;">)</span><span style="color: #007000;">)</span>:
    <span style="color: #db74ade6a207;"> </span>   <span style="color: #db74ade6a207;"> </span>   <span style="color: #aa184f;">&#36755;&#20986;&#26102;&#38388;</span> <span style="color: #393330;">=</span> &#20505;&#36873;&#26102;&#38388; 
    <span style="color: #db74ade6a207;"> </span>   <span style="color: #db74ade6a207;"> </span>   <span style="color: #8f2f30; font-weight: bold;">break</span>
    <span style="color: #db74ade6a207;"> </span>   <span style="color: #aa184f;">&#20505;&#36873;&#26102;&#38388;</span> <span style="color: #393330;">+=</span> &#20559;&#31227;
<span style="color: #8f2f30; font-weight: bold;">elif</span> cron_&#34920;&#36798;&#24335;:
    <span style="color: #aa184f;">n</span> <span style="color: #393330;">=</span> croniter.croniter<span style="color: #007000;">(</span>cron&#34920;&#36798;&#24335;, &#22522;&#20934;&#26102;&#38388;<span style="color: #007000;">)</span> <span style="color: #6e678f; font-style: italic;">#</span><span style="color: #6e678f; font-style: italic;">&#36825;&#26159;&#20010;&#36845;&#20195;&#22120;
</span>    <span style="color: #aa184f;">&#36755;&#20986;&#26102;&#38388;</span> <span style="color: #393330;">=</span> n.get_next<span style="color: #007000;">(</span>datetime<span style="color: #007000;">)</span> <span style="color: #6e678f; font-style: italic;">#</span><span style="color: #6e678f; font-style: italic;">&#27599;&#27425;&#36825;&#26679;&#35843;&#29992;&#37117;&#20250;&#33719;&#21462;&#21040;&#20174;&#22522;&#20934;&#26102;&#38388;&#24320;&#22987;&#65292;&#28385;&#36275;cron&#34920;&#36798;&#24335;&#30340;&#19979;&#19968;&#20010;&#20540;
</span>    <span style="color: #aa184f;">&#35745;&#25968;</span> <span style="color: #393330;">=</span> 0
    <span style="color: #8f2f30; font-weight: bold;">while</span> &#36755;&#20986;&#26102;&#38388; <span style="color: #393330;">&lt;=</span> &#24403;&#21069;&#26102;&#38388;:
    <span style="color: #db74ade6a207;"> </span>   <span style="color: #aa184f;">&#35745;&#25968;</span> <span style="color: #393330;">+=</span> 1
    <span style="color: #db74ade6a207;"> </span>   <span style="color: #8f2f30; font-weight: bold;">if</span> &#35745;&#25968; <span style="color: #393330;">&gt;</span> &#26368;&#22823;&#23581;&#35797;&#27425;&#25968;:
    <span style="color: #db74ade6a207;"> </span>   <span style="color: #db74ade6a207;"> </span>   sys.<span style="color: #a23ea4;">exit</span><span style="color: #007000;">(</span>1<span style="color: #007000;">)</span> <span style="color: #6e678f; font-style: italic;">#</span><span style="color: #6e678f; font-style: italic;">&#25253;&#38169;
</span>    <span style="color: #db74ade6a207;"> </span>   <span style="color: #aa184f;">&#36755;&#20986;&#26102;&#38388;</span> <span style="color: #393330;">=</span> n.get_next<span style="color: #007000;">(</span>datetime<span style="color: #007000;">)</span> 
<span style="color: #8f2f30; font-weight: bold;">else</span>:
    sys.<span style="color: #a23ea4;">exit</span><span style="color: #007000;">(</span>1<span style="color: #007000;">)</span> <span style="color: #6e678f; font-style: italic;">#</span><span style="color: #6e678f; font-style: italic;">&#25253;&#38169;</span>
</code></pre>
</div>
</div>
</div>
<div id="outline-container-org607eada" class="outline-3">
<h3 id="org607eada"><span class="section-number-3">4.4.</span> 更新计划</h3>
<div class="outline-text-3" id="text-4-4">
<p>
最后会将计算出的新日期同时更新到任务的 <code>SCHEDULED</code> 时间戳和 <code>RESCHEDULE_ANCHOR</code> 属性中，并将任务状态重置为 <code>TODO</code> 。<br />
</p>
</div>
</div>
</div>
<div id="outline-container-orgf08de18" class="outline-2">
<h2 id="orgf08de18"><span class="section-number-2">5.</span> 更多示例</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-org284f9ba" class="outline-3">
<h3 id="org284f9ba"><span class="section-number-3">5.1.</span> 每月第三个和最后一个周五</h3>
<div class="outline-text-3" id="text-5-1">
<div class="org-src-container">
<pre class="src src-nil"><code>:RESCHEDULE_CRON: * * 5#3,L5
</code></pre>
</div>
</div>
</div>
<div id="outline-container-orgfea3f49" class="outline-3">
<h3 id="orgfea3f49"><span class="section-number-3">5.2.</span> 每月最后一个星期一</h3>
<div class="outline-text-3" id="text-5-2">
<div class="org-src-container">
<pre class="src src-nil"><code>:RESCHEDULE_CRON: * * L1
</code></pre>
</div>

<p>
L 表示「当月最后一个」， 1 指一周的第一天（周一/Mon）<br />
</p>
</div>
</div>
<div id="outline-container-orgaff4217" class="outline-3">
<h3 id="orgaff4217"><span class="section-number-3">5.3.</span> 每周一上午 9 点</h3>
<div class="outline-text-3" id="text-5-3">
<div class="org-src-container">
<pre class="src src-nil"><code>:RESCHEDULE_CRON: 0 9 * * Mon
</code></pre>
</div>
</div>
</div>
<div id="outline-container-orgaaff6c8" class="outline-3">
<h3 id="orgaaff6c8"><span class="section-number-3">5.4.</span> 每月第三个周四</h3>
<div class="outline-text-3" id="text-5-4">
<div class="org-src-container">
<pre class="src src-nil"><code>:RESCHEDULE_CRON: * * Thu#3
</code></pre>
</div>
</div>
</div>
<div id="outline-container-org67586e2" class="outline-3">
<h3 id="org67586e2"><span class="section-number-3">5.5.</span> 下周一或周五</h3>
<div class="outline-text-3" id="text-5-5">
<div class="org-src-container">
<pre class="src src-nil"><code>:RESCHEDULE_CRON: * * Mon,Fri
</code></pre>
</div>
</div>
</div>
<div id="outline-container-org56dd0db" class="outline-3">
<h3 id="org56dd0db"><span class="section-number-3">5.6.</span> 从特定锚点起每 2 天</h3>
<div class="outline-text-3" id="text-5-6">
<div class="org-src-container">
<pre class="src src-nil"><code>:RESCHEDULE_INTERVAL: 2d
:RESCHEDULE_ANCHOR: 2025-08-03 Sun
</code></pre>
</div>
</div>
</div>
<div id="outline-container-org2821a81" class="outline-3">
<h3 id="org2821a81"><span class="section-number-3">5.7.</span> 每季度第一个星期一</h3>
<div class="outline-text-3" id="text-5-7">
<div class="org-src-container">
<pre class="src src-nil"><code>:RESCHEDULE_CRON: * Jan,Apr,Jul,Oct Mon#1
</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p>© Published by <a href="https://www.gnu.org/software/emacs/">Emacs</a> 31.0.50 (<a href="https://orgmode.org">Org</a> mode 9.8-pre)　|　<a href="https://tomoemami.github.io/rss.xml">RSS</a>　<a href="https://github.com/TomoeMami/tomoemami.github.io/issues">评论</a></p>
</div>
</body>
</html>
